<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>Sign In — Advanced Medical QA</title>
    <meta name="description" content="Secure sign in for the Advanced Medical QA Engine." />
    <link rel="icon" href="favicon.ico" />

    <style>
        /* ===== Color System (adjust if you have brand hex codes) ===== */
        :root {
            --brown-900: #23160f;
            /* darkest shade of brown (background) */
            --brown-800: #2b1b12;
            /* slightly lighter for cards/shadows */
            --off-white: #F8F5F0;
            /* off-white for surfaces/text background */
            --off-white-2: #F2EEE7;
            /* subtle contrast surface */
            --lime: #32CD32;
            /* lime green for primary buttons */
            --lime-700: #2EB82E;
            /* hover state */
            --lime-900: #249F24;
            /* active state */
            --ink: #1b1b1b;
            /* body text on light surfaces */
            --muted: #6f6a63;
            /* secondary text */
            --danger: #D7263D;
            /* error text */
            --focus: #A7F542;
            /* lime-esque focus ring (AA on brown) */
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
        }

        /* ===== Reset & Base ===== */
        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            background: var(--brown-900);
            color: var(--off-white);
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
            line-height: 1.5;
        }

        a {
            color: inherit;
        }

        img {
            max-width: 100%;
            display: block;
        }

        /* ===== Layout ===== */
        .wrap {
            min-height: 100dvh;
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: auto 1fr auto;
        }

        header,
        footer {
            padding: 16px 20px;
            background: transparent;
        }

        .brand {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .brand__logo {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: linear-gradient(145deg, var(--brown-800), #120b07);
            border: 1px solid #3a271d;
            box-shadow: inset 0 0 0 1px #1a110c;
        }

        .brand__name {
            font-weight: 600;
            letter-spacing: .2px;
        }

        main {
            display: grid;
            place-items: center;
            padding: 24px 16px;
        }

        .card {
            width: 100%;
            max-width: 560px;
            background: var(--off-white);
            color: var(--ink);
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 1px solid #e7e0d5;
            overflow: hidden;
        }

        .card__head {
            background: linear-gradient(180deg, #fbfaf7, var(--off-white));
            padding: 28px 28px 16px;
            border-bottom: 1px solid #eee6dc;
        }

        .card__title {
            font-size: 1.4rem;
            margin: 0 0 6px 0;
            color: var(--brown-800);
        }

        .card__sub {
            margin: 0;
            color: var(--muted);
            font-size: .95rem;
        }

        .card__body {
            padding: 24px 28px;
            display: grid;
            gap: 18px;
        }

        /* ===== Form ===== */
        .field {
            display: grid;
            gap: 8px;
        }

        label {
            font-size: .95rem;
            font-weight: 600;
            color: var(--brown-800);
        }

        /* ✅ Include [type="text"] so the input looks the same when Show is toggled */
        input[type="email"],
        input[type="password"],
        input[type="text"],
        select {
            width: 100%;
            padding: 12px 12px;
            border-radius: 10px;
            border: 1px solid #ded6cb;
            background: var(--off-white);
            color: var(--ink);
            outline: none;
            transition: box-shadow .15s ease, border-color .15s ease;
        }

        input::placeholder {
            color: #9a948a;
        }

        input:focus,
        select:focus {
            border-color: var(--lime);
            box-shadow: 0 0 0 4px rgba(50, 205, 50, 0.25);
        }

        .roles {
            display: grid;
            gap: 8px;
            grid-template-columns: 1fr;
        }

        .hint {
            color: var(--muted);
            font-size: .9rem;
        }

        .error {
            display: none;
            color: var(--danger);
            font-size: .9rem;
        }

        /* ===== Buttons ===== */
        .btn {
            appearance: none;
            border: none;
            cursor: pointer;
            padding: 12px 16px;
            border-radius: 12px;
            font-weight: 700;
            letter-spacing: .2px;
            transition: transform .05s ease, box-shadow .2s ease, background .2s ease;
        }

        .btn--primary {
            background: var(--lime);
            color: #0d2a0d;
            box-shadow: 0 8px 18px rgba(50, 205, 50, .25);
        }

        .btn--primary:hover {
            background: var(--lime-700);
        }

        .btn--primary:active {
            background: var(--lime-900);
            transform: translateY(1px);
        }

        .btn--ghost {
            background: transparent;
            color: var(--brown-800);
            border: 1px dashed #cfc6b8;
        }

        .btn[disabled] {
            opacity: .55;
            cursor: not-allowed;
        }

        .actions {
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: space-between;
            margin-top: 4px;
            flex-wrap: wrap;
        }

        /* ===== Accessory ===== */
        .disclaimer {
            background: var(--off-white-2);
            border: 1px solid #e6ded3;
            color: var(--ink);
            padding: 12px 14px;
            border-radius: 12px;
            font-size: .9rem;
        }

        /* New: show/hide password toggle */
        .pw-toggle {
            position: relative;
        }

        .pw-toggle-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: #7b7167;
            cursor: pointer;
            font-weight: 700;
            padding: 0 4px;
            /* keep compact so height doesn't change */
            line-height: 1;
            /* keep vertical alignment stable */
        }

        /* ===== Footer ===== */
        footer {
            color: #d9d0c6;
            font-size: .92rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .build {
            opacity: .85;
        }

        /* ===== Responsive ===== */
        @media (min-width: 640px) {
            .roles {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>

<body>
    <div class="wrap">
        <header aria-label="Application header">
            <div class="brand">
                <div class="brand__logo" aria-hidden="true"></div>
                <div class="brand__name">Advanced Medical QA</div>
            </div>
        </header>

        <main>
            <section class="card" aria-label="Sign in panel">
                <div class="card__head">
                    <h1 class="card__title">Sign in to continue</h1>
                    <p class="card__sub">
                        For clinicians and researchers—evidence‑grounded medical answers with citations.
                    </p>
                </div>

                <form class="card__body" id="signinForm" novalidate>
                    <!-- Email -->
                    <div class="field">
                        <label for="email">Email</label>
                        <input id="email" name="email" type="email" inputmode="email" autocomplete="username"
                            placeholder="you@hospital.org" required aria-describedby="emailHint emailError" />
                        <div class="hint" id="emailHint">Use your institutional or demo email.</div>
                        <div class="error" id="emailError">Please enter a valid email address.</div>
                    </div>

                    <!-- Password (with show/hide toggle) -->
                    <div class="field">
                        <label for="password">Password</label>
                        <div class="pw-toggle">
                            <input id="password" name="password" type="password" autocomplete="current-password"
                                placeholder="••••••••" minlength="6" required aria-describedby="pwHint pwError" />
                            <button type="button" class="pw-toggle-btn" id="pwToggle"
                                aria-label="Show password">Show</button>
                        </div>
                        <div class="hint" id="pwHint">Minimum 6 characters for the prototype.</div>
                        <div class="error" id="pwError">Password must be at least 6 characters.</div>
                    </div>

                    <!-- Role Selection -->
                    <div class="field">
                        <label for="role">Sign in as</label>
                        <select id="role" name="role" required aria-describedby="roleHint roleError">
                            <option value="" disabled selected>Select a role</option>
                            <option value="clinician">Clinician</option>
                            <option value="researcher">Researcher</option>
                            <option value="demo">Demo User</option>
                        </select>
                        <div class="hint" id="roleHint">Role controls which features you see (e.g., Admin dashboards
                            hidden).</div>
                        <div class="error" id="roleError">Please select a role to continue.</div>
                    </div>

                    <!-- Inline global auth error (hidden by default) -->
                    <div class="error" id="authError" role="alert" style="display:none;">
                        Please correct the highlighted fields.
                    </div>

                    <!-- Disclaimer -->
                    <div class="disclaimer" role="note" aria-label="Clinical disclaimer">
                        <strong>Clinical use disclaimer:</strong> This prototype is an assistive tool and does not
                        provide medical diagnosis. Verify all outputs against clinical judgment and current guidelines.
                        Sources and timestamps are shown in subsequent screens.
                    </div>

                    <!-- Actions -->
                    <div class="actions">
                        <button type="submit" class="btn btn--primary" id="continueBtn"
                            aria-label="Continue to the app">
                            Continue
                        </button>

                        <button type="button" class="btn btn--ghost" id="demoBtn"
                            aria-label="Use demo mode (no password)">
                            Try Demo
                        </button>
                    </div>
                </form>
            </section>
        </main>

        <footer aria-label="Application footer">
            <div>© <span id="year"></span> Advanced Medical QA — Prototype</div>
            <div class="build">Build v0.1 • Last sync: not connected</div>
        </footer>
    </div>

    <script src="assets/app.js"></script>
    <script>
        (function () {
            // Always set the footer year
            const yearEl = document.getElementById('year');
            if (yearEl) yearEl.textContent = new Date().getFullYear();

            const form = document.getElementById('signinForm');
            const email = document.getElementById('email');
            const password = document.getElementById('password');
            const role = document.getElementById('role');

            const emailError = document.getElementById('emailError');
            const pwError = document.getElementById('pwError');
            const roleError = document.getElementById('roleError');
            const authError = document.getElementById('authError');

            const pwToggle = document.getElementById('pwToggle');

            function validEmail(v) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }
            function show(el) { if (el) el.style.display = 'block'; }
            function hide(el) { if (el) el.style.display = 'none'; }
            function inlineError(input, errorEl, ok) {
                if (!errorEl) return;
                if (ok) { hide(errorEl); input?.removeAttribute('aria-invalid'); }
                else { show(errorEl); input?.setAttribute('aria-invalid', 'true'); }
            }

            // Show/hide password (keeps identical styling because we style [type="text"] now)
            pwToggle?.addEventListener('click', () => {
                const isPw = password.getAttribute('type') === 'password';
                password.setAttribute('type', isPw ? 'text' : 'password');
                pwToggle.textContent = isPw ? 'Hide' : 'Show';
                pwToggle.setAttribute('aria-label', isPw ? 'Hide password' : 'Show password');
                password.focus();
            });

            // Submit on Enter from inputs (UX nicety)
            [email, password, role].forEach(el => {
                el?.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        form.requestSubmit?.() || form.submit();
                    }
                });
            });

            // Demo shortcut
            document.getElementById('demoBtn')?.addEventListener('click', () => {
                if (window.AMQA?.setRole && window.AMQA?.go) {
                    AMQA.setRole('demo');
                    AMQA.go('context'); // → PatientContext.html
                } else {
                    // Fallback if app.js not loaded
                    window
                }
            });

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                hide(authError);

                const emailOk = validEmail(email.value.trim());
                const pwOk = (password.value || '').length >= 6; // keep your original minlength
                const roleOk = !!role.value;

                inlineError(email, emailError, emailOk);
                inlineError(password, pwError, pwOk);
                inlineError(role, roleError, roleOk);

                if (!(emailOk && pwOk && roleOk)) {
                    show(authError);
                    return;
                }

                // Store role & navigate
                if (window.AMQA?.setRole && window.AMQA?.go) {
                    AMQA.setRole(role.value);
                    AMQA.go('context');  // → PatientContext.html
                } else {
                    // Fallback if app.js not loaded
                    window.location.href = 'PatientContext.html';
                }
            });
        })();
    </script>
</body>

</html>